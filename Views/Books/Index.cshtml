@model BibliotekaInternetowa.Models.BookSearchViewModel

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">Katalog książek</h2>
        @if (User.IsInRole("Admin"))
        {
            <a asp-action="Create" class="btn btn-primary">
                ➕ Dodaj nową książkę
            </a>
        }
    </div>

    <!-- Formularz wyszukiwania i filtrowania -->
    <div class="card mb-4">
        <div class="card-body">
            <form asp-action="Index" method="get" class="row g-3">
                <div class="col-md-4">
                    <label for="searchTerm" class="form-label">🔍 Wyszukaj</label>
                    <input type="text" class="form-control" id="searchTerm" name="searchTerm" 
                           value="@Model.SearchTerm" placeholder="Tytuł, autor lub ISBN">
                </div>
                <div class="col-md-2">
                    <label for="category" class="form-label">📚 Kategoria</label>
                    <select class="form-select" id="category" name="category">
                        <option value="">Wszystkie</option>
                        @foreach (var cat in Model.Categories)
                        {
                            <option value="@cat" selected="@(Model.Category == cat)">@cat</option>
                        }
                    </select>
                </div>
                <div class="col-md-2">
                    <label for="availability" class="form-label">✅ Dostępność</label>
                    <select class="form-select" id="availability" name="availability">
                        <option value="all" selected="@(Model.Availability == "all")">Wszystkie</option>
                        <option value="available" selected="@(Model.Availability == "available")">Dostępne</option>
                        <option value="unavailable" selected="@(Model.Availability == "unavailable")">Niedostępne</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label for="minYear" class="form-label">📅 Rok od</label>
                    <input type="number" class="form-control" id="minYear" name="minYear" 
                           value="@Model.MinYear" placeholder="np. 2000" min="1000" max="2100">
                </div>
                <div class="col-md-2">
                    <label for="maxYear" class="form-label">📅 Rok do</label>
                    <input type="number" class="form-control" id="maxYear" name="maxYear" 
                           value="@Model.MaxYear" placeholder="np. 2025" min="1000" max="2100">
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary me-2">🔍 Szukaj</button>
                    <a asp-action="Index" class="btn btn-outline-secondary">🔄 Wyczyść</a>
                    @if (!string.IsNullOrWhiteSpace(Model.SearchTerm) || 
                         !string.IsNullOrWhiteSpace(Model.Category) || 
                         (Model.Availability != null && Model.Availability != "all") ||
                         Model.MinYear.HasValue || Model.MaxYear.HasValue)
                    {
                        <span class="ms-2 text-muted">
                            Znaleziono: <strong>@Model.Books.Count</strong> książek
                        </span>
                    }
                </div>
            </form>
        </div>
    </div>

    @if (!Model.Books.Any())
    {
        <div class="alert alert-info text-center">
            <p class="mb-0">
                @if (!string.IsNullOrWhiteSpace(Model.SearchTerm) || 
                     !string.IsNullOrWhiteSpace(Model.Category) || 
                     (Model.Availability != null && Model.Availability != "all") ||
                     Model.MinYear.HasValue || Model.MaxYear.HasValue)
                {
                    <text>Nie znaleziono książek spełniających kryteria wyszukiwania.</text>
                }
                else
                {
                    <text>Brak książek w katalogu.</text>
                }
            </p>
        </div>
    }
    else
    {
        <div class="row g-4">
            @foreach (var item in Model.Books)
            {
                <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                    <div class="card h-100 shadow-sm book-card">
                        <div class="book-cover-container">
                            @if (!string.IsNullOrEmpty(item.CoverImageUrl))
                            {
                                <img src="@item.CoverImageUrl" alt="@item.Title" class="book-cover" onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\'no-cover\'><div class=\'no-cover-icon\'>📚</div><span>Brak okładki</span></div>'">
                            }
                            else
                            {
                                <div class="no-cover">
                                    <div class="no-cover-icon">📚</div>
                                    <span>Brak okładki</span>
                                </div>
                            }
                        </div>
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">@item.Title</h5>
                            <p class="card-text text-muted mb-2">
                                <small><strong>Autor:</strong> @item.Author</small>
                            </p>
                            <p class="card-text">
                                <small class="text-muted">@item.PublicationYear</small>
                            </p>
                            <div class="availability-badge mb-3">
                                @if (item.AvailableCopies > 0)
                                {
                                    <span class="badge bg-success">Dostępna (@item.AvailableCopies/@item.TotalCopies)</span>
                                }
                                else
                                {
                                    <span class="badge bg-danger">Niedostępna</span>
                                }
                            </div>
                            <div class="mt-auto">
                                <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-outline-primary w-100 mb-2">
                                    Szczegóły
                                </a>
                                @if (User.IsInRole("Admin"))
                                {
                                    <div class="btn-group w-100" role="group">
                                        <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-outline-secondary">
                                            Edytuj
                                        </a>
                                        <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-outline-danger">
                                            Usuń
                                        </a>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

<style>
    .book-card {
        transition: transform 0.2s, box-shadow 0.2s;
        border: none;
        overflow: hidden;
    }

    .book-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 1rem rgba(212, 165, 116, 0.25) !important;
    }

    .book-cover-container {
        width: 100%;
        height: 300px;
        background: linear-gradient(135deg, #fff9e6 0%, #ffe8b3 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        position: relative;
    }

    .book-cover {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .no-cover {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #8b7355;
        text-align: center;
        padding: 20px;
        height: 100%;
    }

    .no-cover-icon {
        font-size: 4rem;
        margin-bottom: 10px;
        opacity: 0.8;
        line-height: 1;
    }

    .no-cover span {
        font-size: 0.9rem;
        font-weight: 500;
    }

    .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #3d3d2e;
        min-height: 3rem;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .availability-badge {
        margin-top: auto;
    }

    @@media (max-width: 576px) {
        .book-cover-container {
            height: 250px;
        }
    }
</style>