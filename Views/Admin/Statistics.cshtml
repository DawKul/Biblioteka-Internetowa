@model BibliotekaInternetowa.Models.StatisticsViewModel

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">üìä Statystyki</h1>
        <div>
            <a asp-action="GenerateStatisticsReport" class="btn btn-danger me-2">
                üìÑ Pobierz PDF
            </a>
            <a asp-action="Dashboard" class="btn btn-outline-secondary">‚Üê Powr√≥t do dashboardu</a>
        </div>
    </div>

    <div class="row g-4">
        <!-- Wykres wypo≈ºycze≈Ñ wed≈Çug miesiƒÖca -->
        <div class="col-12 col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">üìÖ Wypo≈ºyczenia wed≈Çug miesiƒÖca (ostatnie 12 miesiƒôcy)</h5>
                </div>
                <div class="card-body">
                    <canvas id="borrowingsByMonthChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Wykres ksiƒÖ≈ºek wed≈Çug kategorii -->
        <div class="col-12 col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">üìö KsiƒÖ≈ºki wed≈Çug kategorii</h5>
                </div>
                <div class="card-body">
                    <canvas id="booksByCategoryChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Wykres wypo≈ºycze≈Ñ wed≈Çug statusu -->
        <div class="col-12 col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">üìä Wypo≈ºyczenia wed≈Çug statusu</h5>
                </div>
                <div class="card-body">
                    <canvas id="borrowingsByStatusChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Top u≈ºytkownicy -->
        <div class="col-12 col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">‚≠ê Top 10 u≈ºytkownik√≥w</h5>
                </div>
                <div class="card-body">
                    @if (!Model.TopUsers.Any())
                    {
                        <p class="text-muted text-center">Brak danych</p>
                    }
                    else
                    {
                        <ol class="list-group list-group-numbered">
                            @foreach (var user in Model.TopUsers)
                            {
                                <li class="list-group-item d-flex justify-content-between align-items-start">
                                    <div class="ms-2 me-auto">
                                        <div class="fw-bold">@user.UserName</div>
                                        @if (!string.IsNullOrEmpty(user.FullName))
                                        {
                                            <small class="text-muted">@user.FullName</small>
                                        }
                                    </div>
                                    <span class="badge bg-primary rounded-pill">@user.BorrowingsCount</span>
                                </li>
                            }
                        </ol>
                    }
                </div>
            </div>
        </div>

        <!-- Top ksiƒÖ≈ºki -->
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">üìñ Top 10 najczƒô≈õciej wypo≈ºyczanych ksiƒÖ≈ºek</h5>
                </div>
                <div class="card-body">
                    @if (!Model.TopBooks.Any())
                    {
                        <p class="text-muted text-center">Brak danych</p>
                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Pozycja</th>
                                        <th>Tytu≈Ç</th>
                                        <th>Autor</th>
                                        <th>Liczba wypo≈ºycze≈Ñ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{ int position = 1; }
                                    @foreach (var book in Model.TopBooks)
                                    {
                                        <tr>
                                            <td><strong>#@position</strong></td>
                                            <td><strong>@book.Title</strong></td>
                                            <td>@book.Author</td>
                                            <td><span class="badge bg-primary">@book.BorrowingsCount</span></td>
                                        </tr>
                                        position++;
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Wykres wypo≈ºycze≈Ñ wed≈Çug miesiƒÖca
    const borrowingsByMonthData = {
        labels: [@Html.Raw(string.Join(", ", Model.BorrowingsByMonth.Keys.Select(k => $"'{k}'")))],
        datasets: [{
            label: 'Liczba wypo≈ºycze≈Ñ',
            data: [@string.Join(", ", Model.BorrowingsByMonth.Values)],
            backgroundColor: 'rgba(212, 165, 116, 0.5)',
            borderColor: 'rgba(212, 165, 116, 1)',
            borderWidth: 2
        }]
    };

    new Chart(document.getElementById('borrowingsByMonthChart'), {
        type: 'line',
        data: borrowingsByMonthData,
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: true
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Wykres ksiƒÖ≈ºek wed≈Çug kategorii
    const booksByCategoryData = {
        labels: [@Html.Raw(string.Join(", ", Model.BooksByCategory.Keys.Select(k => $"'{k}'")))],
        datasets: [{
            label: 'Liczba ksiƒÖ≈ºek',
            data: [@string.Join(", ", Model.BooksByCategory.Values)],
            backgroundColor: [
                'rgba(212, 165, 116, 0.6)',
                'rgba(107, 142, 35, 0.6)',
                'rgba(70, 130, 180, 0.6)',
                'rgba(255, 140, 0, 0.6)',
                'rgba(220, 20, 60, 0.6)',
                'rgba(138, 43, 226, 0.6)',
                'rgba(255, 215, 0, 0.6)'
            ],
            borderWidth: 2
        }]
    };

    new Chart(document.getElementById('booksByCategoryChart'), {
        type: 'doughnut',
        data: booksByCategoryData,
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'right'
                }
            }
        }
    });

    // Wykres wypo≈ºycze≈Ñ wed≈Çug statusu
    const borrowingsByStatusData = {
        labels: [@Html.Raw(string.Join(", ", Model.BorrowingsByStatus.Keys.Select(k => $"'{k}'")))],
        datasets: [{
            label: 'Liczba wypo≈ºycze≈Ñ',
            data: [@string.Join(", ", Model.BorrowingsByStatus.Values)],
            backgroundColor: [
                'rgba(107, 142, 35, 0.6)',
                'rgba(128, 128, 128, 0.6)',
                'rgba(220, 20, 60, 0.6)'
            ],
            borderWidth: 2
        }]
    };

    new Chart(document.getElementById('borrowingsByStatusChart'), {
        type: 'bar',
        data: borrowingsByStatusData,
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

